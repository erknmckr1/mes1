"use client";
import "./globals.css";
import Header from "@/components/headers/Header";
import { ToastContainer } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import { Provider } from "react-redux";
import store from "@/redux/store/store";
import AuthProvider from "@/components/authProvider/AuthProvider";
import MolaPopup from "@/components/popups/MolaPopup";
import { useSelector } from "react-redux";
import FoodPopup from "@/components/popups/FoodPopup";
import StopJobPopup from "@/components/popups/StopJobPopup";
import CancelJobPopup from "@/components/popups/CancelJobPopup";
import RepairJobPopup from "@/components/popups/RepairJobPopup";
import FinishedWorkPopup from "@/components/popups/kalite/FinishedWorkPopup";
import { usePathname } from "next/navigation";
import HomeSidebars from "@/components/sideBars/HomeSidebars";
import CurrentDate from "@/components/ui/Date";
import OrderGroupManagement from "@/components/popups/OrderGroupManagement";
import SendToMachinePopup from "@/components/popups/SendToMachinePopup";
import MeasurementDataEntry from "@/components/popups/MeasurementDataEntry";
import ConditionalFinish from "@/components/popups/ConditionalFinish";
// export const metadata = {
//   title: "Create Next App",
//   description: "Generated by create next app",
// };

// Layout komponenti, sayfanın genel yapısını ve pop-up bileşenlerini yönetir
function Layout({ children }) {
  const pathName = usePathname();
  const project = pathName.split("/")[1];
  const section = pathName.split("/")[2];
  const area_name = pathName.split("/")[3];
  const foodPopupState = useSelector((state) => state.global.foodPopupState);
  const isMolaPopup = useSelector((state) => state.global.isMolaPopup);
  const {
    stopReasonPopup,
    cancelReasonPopup,
    repairJobPopup,
    finishedWorkPopup,
    groupManagementPopup,
    sendToMachinePopup,
    measurementEntryPopup,
    conditionalFinishPopup
  } = useSelector((state) => state.order);

  // useEffect(() => {
  //   // 5 dakikada bir sayfayı yenile
  //   const intervalId = setInterval(() => {
  //     window.location.assign(`http://192.168.3.7:3000/uretim/${section}/${area_name}`);
  //   }, 300000); // 5 dakika = 300000 milisaniye

  //   // Cleanup function to clear the interval
  //   return () => clearInterval(intervalId);
  // }, [section, area_name]); // section ve area_name değiştiğinde interval yeniden oluşturulacak

  return (
    <>
      {project === "uretim" && <Header />}
      {/* {project === "home" && <MainHeader />} */}
      <main className="relative">{children}</main>
      {isMolaPopup && <MolaPopup />}
      {foodPopupState && <FoodPopup />}
      {stopReasonPopup && <StopJobPopup />}
      {cancelReasonPopup && <CancelJobPopup />}
      {repairJobPopup && <RepairJobPopup />}
      {finishedWorkPopup && <FinishedWorkPopup />}
      {groupManagementPopup && <OrderGroupManagement/>}
      {sendToMachinePopup && <SendToMachinePopup/>}
      {measurementEntryPopup && <MeasurementDataEntry/>}
      {conditionalFinishPopup && <ConditionalFinish/>}
      <ToastContainer />
    </>
  );
}

function HomeLayout({ children }) {
  const pathName = usePathname();
  const project = pathName.split("/")[1];
  return (
    <>
      {project === "home" && (
        <div className="w-screen h-screen flex">
          <HomeSidebars />
          <div className="flex-1 w-full flex flex-col">
            <div className="h-[100px] w-full border-secondary border-b shadow-lg flex items-center justify-between px-4">
              <div></div>
              <div className="flex items-center space-x-4">
                <div className="text-green-500 font-semibold text-[30px]">
                  <CurrentDate addProps={"text-[30px]"} />
                </div>
              </div>
            </div>
            <main className="flex-1 p-4 overflow-auto">{children}</main>
          </div>
        </div>
      )}
      <ToastContainer />
    </>
  );
}

// RootLayout, uygulamanın temel yapısını ve Redux sağlayıcısını yönetir
export default function RootLayout({ children }) {
  const pathName = usePathname();
  const project = pathName.split("/")[1];
  return (
    <html lang="tr">
      <body>
        <Provider store={store}>
          <AuthProvider>
            {project === "home" ? (
              <HomeLayout>{children}</HomeLayout>
            ) : (
              <Layout>{children}</Layout>
            )}
          </AuthProvider>
        </Provider>
      </body>
    </html>
  );
}
